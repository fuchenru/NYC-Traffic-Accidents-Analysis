---
title: "SSC 442 - Final Project"
author: "Peter Fu Chen , Mike Liu"
date: "`r Sys.Date()`"
output: pdf_document
---

PowerPoint reference: https://www.linkedin.com/in/hoyuli/overlay/1593491717863/single-media-viewer/?profileId=ACoAABGobQoBad3aoz8Aka2DErr_wx3A9UJhl50

Analysis reference: https://www.kaggle.com/datasets/mysarahmadbhat/nyc-traffic-accidents/code


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# NYC Traffic Accidents Analysis

## Background and Motivation

The focus of this project is the examination of motor vehicle collisions that were reported by the New York City Police Department from January to August of 2020. Each record in the dataset, obtained from Kaggle, represents a unique collision and includes various details such as the date, time, and location of the accident, as well as additional data.

The analysis will compare the percentage of total accidents by month, providing a snapshot of the trend over time. These statistics will be visually represented through the use of maps, which will demonstrate the frequency of accidents in different boroughs of New York City. Furthermore, the analysis will also determine the most common streets, days, and times when accidents are likely to occur.

The ultimate goal of this project is to provide recommendations to the city of New York on how this analysis can be used to prevent future accidents. By highlighting the most common accident hotspots, times, and contributing factors, city planners and law enforcement officials will be equipped with the information necessary to implement effective safety measures and reduce the number of accidents in the city.


## Methodology

*Loading libraries*
```{r error=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggthemes)
library(ggmap)
library(ggrepel)
library(lubridate)
```


### Data preparation

```{r}
# First of all, that's read the data and take a glimpse what it contains
df = read.csv("NYC Accidents 2020.csv")
glimpse(df)
```

```{r}
# Check for missing values
sum(is.na(df))
```


```{r}
# Drop all the NAs
df_withoutna <- na.omit(df)

# We also need to drop LATITUDE equal 0, otherwise it will cause problems when we plot
df_withoutna<- df_withoutna[df_withoutna$LATITUDE != 0,]

#Check if all the NAs are droped
sum(is.na(df_withoutna))
```

```{r}
# Use lubridate() to change the date format
df_withoutna$CRASH.DATE = mdy(df_withoutna$CRASH.DATE)
```


```{r}
# Drop some unnecessary columns
df_withoutna = df_withoutna %>% select(1:18)
glimpse(df_withoutna)
```

### Map plotting the people killed by motor vehicle in NYC

First and foremost, let's examine the number of fatalities resulting from motor vehicle accidents across New York City in 2020. To represent each death, we have used dots on a map and it's evident that the concentration of these dots varies among different boroughs. Upon initial inspection, it appears that Manhattan, the Bronx, and Brooklyn have the highest density of dots, indicating a higher rate of fatalities in these areas.

Next, we will employ various analytical techniques to determine which borough is experiencing the most severe problem and to understand how public policy can be utilized to address this issue. By analyzing the data and identifying trends, we can work towards developing effective strategies that can help reduce the number of motor vehicle-related fatalities in New York City.


```{r}
qmplot(data = df_withoutna, x = LONGITUDE, y = LATITUDE, maptype = "terrain",
      darken = 0, geom = "auto", color = NUMBER.OF.PERSONS.KILLED , 
      alpha=I(.5), size = I(0.0000001), 
      zoom = 10,extent = "panel",f = 0.005, 
      xlab = "", ylab = "", main = "NYC Traffic Accidents Killed") +
      theme(axis.ticks = element_blank(), axis.text = element_blank()) +
      theme(legend.position="none")
```


### Descriptive statistics: Summarize the main characteristics of the data set, such as the mean, median, and standard deviation of the number of accidents and injuries.





### Regression analysis: Model the relationship between the number of accidents and borough. 

```{r}
model <- lm(NUMBER.OF.PERSONS.INJURED ~ BOROUGH, data = df)

# Summarize the model
summary(model)
```

### Accidents Per Month

```{r}
month_accidents = df_withoutna %>% group_by(month(CRASH.DATE)) %>%
  summarise(sum(NUMBER.OF.PERSONS.INJURED , NUMBER.OF.PERSONS.KILLED)) %>%
  rename("Month" = "month(CRASH.DATE)") %>%
  rename("Total_accidents" = "sum(NUMBER.OF.PERSONS.INJURED, NUMBER.OF.PERSONS.KILLED)")

ggplot(month_accidents, aes(x = Month, y = Total_accidents, color = Total_accidents)) +
  geom_bar(stat = "identity", position = "dodge", colour = "black") +
  scale_x_discrete(limits = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug")) +
  geom_text(aes(label = Total_accidents), position = position_dodge(0.9), vjust = 2, size = 4, color = "#ffffff") +
  xlab("Month") + ylab("Total Accidents") +
  ggtitle("Total Accidents by Month in NYC") +
  theme_stata() +
  theme(legend.position = "none", 
        axis.text = element_text(size = 12),
        plot.title = element_text(size = 18, face = "bold"),
        legend.text = element_text(size = 12),
        axis.ticks.x = element_blank()) 
  
```

### Accidents Per day

```{r}
day_accidents <- df_withoutna %>% 
  mutate(dotw = wday(CRASH.DATE)) %>% 
   group_by(dotw) %>%
   summarise(total_accidents = sum(sum(NUMBER.OF.PERSONS.INJURED , NUMBER.OF.PERSONS.KILLED)))


ggplot(day_accidents, aes(x = dotw, y = total_accidents, color = total_accidents)) +
  geom_bar(stat = "identity", colour = "black") +
  scale_x_discrete(limits = c("Mon", "Tue", "Wed", "Thur", "Fri", "Sat", "Sun")) +
  ggtitle("Total accicents per day of the week in NYC") +
  xlab("") +
  ylab("Counts") +
  geom_text(aes(label = total_accidents), position = position_dodge(0.9), vjust = 2, size = 4, color = "#ffffff") +
  theme_stata() +
  theme(legend.position = "none", 
        axis.text = element_text(size = 12),
        plot.title = element_text(size = 18, face = "bold"),
        legend.text = element_text(size = 12),
        axis.ticks.x = element_blank()) 
```


### Accidents, injured and killed per borough

```{r}
df %>% group_by(BOROUGH) %>% 
  summarise(injuries = sum(NUMBER.OF.PERSONS.INJURED),
            deaths = sum(NUMBER.OF.PERSONS.KILLED),
            total = sum(injuries, deaths)) %>%
  filter(row_number() != 1) %>%
  ggplot(aes(x = BOROUGH, y = total, fill = total)) +
  geom_bar(stat = "identity", colour = "black") +
  ggtitle("Total accicents by borough") +
  xlab("") +
  ylab("Total") +
  geom_text(aes(label = total), position = position_dodge(0.9), vjust = 2, size = 4, color = "#ffffff") +
  theme_stata() +
  theme(legend.position = "none", 
        axis.text = element_text(size = 12),
        plot.title = element_text(size = 18, face = "bold"),
        legend.text = element_text(size = 12),
        axis.ticks.x = element_blank()) 
```

### Work in progress.....

```{r }
df %>% group_by(CONTRIBUTING.FACTOR.VEHICLE.1) %>% 
  summarise(injuries = sum(NUMBER.OF.PERSONS.INJURED),
            deaths = sum(NUMBER.OF.PERSONS.KILLED),
            total = sum(injuries, deaths)) %>%
  filter(row_number() != 1) %>%
  arrange(desc(total)) %>%
  slice(1:15) %>%
  ggplot(aes(x = reorder(CONTRIBUTING.FACTOR.VEHICLE.1, total, FUN = desc), y = total, fill = total)) +
  geom_bar(stat = "identity",color = "black") +
  ggtitle("Total Number of Accidents by Contributing Factor") +
  xlab("Contributing Factor") +
  ylab("Number of Accidents") +
  # geom_text(aes(label = total), position = position_dodge(0.9), vjust = 2, size = 4, color = "#ffffff") +
  geom_label_repel(aes(label = CONTRIBUTING.FACTOR.VEHICLE.1), color = "white", size = 2.5, max.overlaps = 15) +
  theme_stata() +
  theme(axis.text.x = element_blank(),
        plot.title = element_text(size = 18, face = "bold"),
        legend.text = element_text(size = 12),
        legend.position = "none",
        axis.ticks.x = element_blank())
```









```{r}
# df
```















